---
import type { EntryFieldTypes } from "contentful"
import { contentfulClient } from "../lib/contentful"
import Property from "./Property.astro"

interface PropertyType {
	contentTypeId: "property"
	fields: {
		id: EntryFieldTypes.Number
		localization: EntryFieldTypes.Location
		precio: EntryFieldTypes.Number
		photos: EntryFieldTypes.EntryResourceLink<Photo>[]
		title: EntryFieldTypes.Text
	}
}

interface Photo {
	contentTypeId: "photo"
	fields: {
		file: {
			url: string
		}
	}
}

const entries = await contentfulClient.getEntries<PropertyType>({
	content_type: "property",
})

const properties = entries.items.map((entry) => entry.fields)
---

<article class="mx-auto grid grid-cols-2 gap-4 p-4 md:grid-cols-3 lg:grid-cols-3">
	{
		properties.map((property) => {
			const photos = property.photos
				? (property.photos as Photo[]).map((photo) => photo.fields.file.url)
				: ([] as Photo[])

			return (
				<Property
					key={property.id}
					id={property.id}
					photos={photos}
					title={property.title}
					precio={property.precio}
				/>
			)
		})
	}
</article>
